import { SVGProps } from "react";

export type IconSvgProps = SVGProps<SVGSVGElement> & {
  size?: number;
};

// Conversation starter structure
export interface ConversationStarter {
  title: string;
  question: string;
  openingRemarks?: string; // Optional pre-written response to avoid AI latency on first interaction
}

// Voice emotion options for avatar speech
export enum VoiceEmotion {
  EXCITED = "excited",
  SERIOUS = "serious",
  FRIENDLY = "friendly",
  SOOTHING = "soothing",
  BROADCASTER = "broadcaster"
}

// Avatar voice configuration
export interface VoiceConfig {
  rate: number; // 0.5 - 2.0
  voiceId: string;
  emotion?: VoiceEmotion;
}

// Avatar rendering and behavior settings
export interface StartAvatarRequest {
  quality: "low" | "medium" | "high";
  avatarName: string;
  knowledgeId?: string;
  voice: VoiceConfig;
  language: string; // Two lowercase letters (en, zh, ko, vi, fr, de, ja)
}

/**
 * Persona (Case Study architecture): reusable visual shell only.
 * Appearance + voice configuration. No system prompt, knowledge, or case-specific data.
 */
export interface Persona {
  id: string;
  name: string;
  professionalTitle: string;
  avatarImageUrl?: string;
  voiceId: string;
  voiceRate: number;
  language: string;
  voiceEmotion?: string;
  animationSet?: string;
  createdAt: string;
  updatedAt: string;
}

/**
 * CHAT STORAGE IMPLEMENTATION - CENTRALIZED TYPE DEFINITIONS
 * 
 * This section implements the chat storage types required by the meeting summary (Section #9).
 * The meeting specified: "serialize the chat as one JSON file in S3 under a future /chats/ prefix"
 * and "maybe store chat-IDs in IndexedDB for quick lookup".
 * 
 * These types provide the foundation for the entire chat storage system and ensure
 * consistency across all components, services, and API endpoints.
 */

/**
 * ChatMessage Interface
 * 
 * Centralizes the chat message structure that was previously duplicated across components.
 * This replaces the local ChatMessage interfaces in:
 * - app/kiosk/touch-screen/page.tsx
 * - app/kiosk/main-display/page.tsx
 * - components/preview-chat-full.tsx
 * - components/preview-chat-small.tsx
 * 
 * Design decisions:
 * - Uses "user" | "assistant" roles to match OpenAI API conventions
 * - Timestamp as number (Unix timestamp) for easy sorting and date operations
 * - Content as string to support both text and special status messages ("ðŸŽ¤ Recording...")
 * - Minimal structure for efficient storage and transmission
 */
export interface ChatMessage {
  role: "user" | "assistant";           // Message sender - user input or AI response
  content: string;                       // Message text content
  timestamp: number;                     // Unix timestamp when message was created
}

/**
 * ChatSessionMetadata Interface
 * 
 * Contains all metadata about a chat session for analytics, filtering, and management.
 * This supports the "analytics pipeline" mentioned as future work in the meeting.
 * 
 * Key features:
 * - sessionId: Unique identifier for the chat session (timestamp + random)
 * - avatarId/avatarName: Links chat to specific avatar for analytics
 * - userId/userName: Optional user identification (for future user tracking)
 * - startTime/endTime: Session duration tracking
 * - messageCount: Quick metric without loading full messages array
 * - isKioskMode: Distinguishes kiosk interactions from preview chats
 * - location: Future support for multiple kiosk locations
 */
export interface ChatSessionMetadata {
  sessionId: string;                     // Unique session identifier (generated by S3 client)
  avatarId: string;                      // ID of avatar involved in conversation
  avatarName: string;                    // Name of avatar (for display/analytics)
  userId?: string;                       // Optional user identifier (future enhancement)
  userName?: string;                     // Optional user name (future enhancement)
  startTime: number;                     // Unix timestamp when chat session began
  endTime: number;                       // Unix timestamp when chat session ended
  messageCount: number;                  // Total number of messages in session
  isKioskMode: boolean;                  // True for kiosk interactions, false for preview chats
  location?: string;                     // Optional kiosk location identifier (future use)
}

/**
 * ChatSession Interface
 * 
 * Complete chat session structure for S3 storage, implementing the meeting requirement:
 * "serialize the chat as one JSON file in S3 under a future /chats/ prefix"
 * 
 * This is the main data structure that gets saved to S3 as JSON files.
 * Structure: chats/{sessionId}.json
 * 
 * Design rationale:
 * - metadata: Separate object for easy querying and analytics
 * - messages: Array of all chat messages in chronological order
 * - createdAt/updatedAt: Standard audit fields for debugging and sync
 * 
 * Example S3 storage:
 * chats/1703123456789_abc123def.json = {
 *   metadata: { sessionId: "1703123456789_abc123def", avatarId: "weather-bot", ... },
 *   messages: [{ role: "user", content: "Hello", timestamp: 1703123456789 }, ...],
 *   createdAt: "2023-12-20T12:34:56.789Z",
 *   updatedAt: "2023-12-20T12:34:56.789Z"
 * }
 */
export interface ChatSession {
  metadata: ChatSessionMetadata;         // Session metadata for analytics and filtering
  messages: ChatMessage[];              // Complete conversation history
  createdAt: string;                     // ISO timestamp when session was first created
  updatedAt: string;                     // ISO timestamp when session was last modified
}

/**
 * ==================================================================================
 * CALL TO ACTION (CTA) TYPES - NEW IMPLEMENTATION
 * ==================================================================================
 * 
 * Types for the Call to Action feature that allows users to save chat sessions
 * and connect with Weatherhead via QR codes and forms.
 */

/**
 * CTA Configuration Interface
 * 
 * Stores admin-configurable settings for the CTA system.
 * This is stored in S3 and managed through the admin portal.
 */
export interface CTAConfig {
  id: string;                           // Configuration ID (default: "main")
  enabled: boolean;                     // Whether CTA feature is active
  emailRecipients: string[];            // Case email addresses to notify on submissions
  qrCodeBaseUrl: string;                // Base URL for QR code links (e.g., "https://domain.com/cta")
  formTitle: string;                    // Title displayed on the CTA form
  formDescription: string;              // Description text on the CTA form
  submitButtonText: string;             // Text for the submit button
  successMessage: string;               // Message shown after successful submission
  emailSubject: string;                 // Email subject template
  emailTemplate: string;                // Email body template (with placeholders)
  maxMessageLength: number;             // Maximum characters for user message (default: 500)
  lastUpdated: string;                  // ISO timestamp of last configuration update
  updatedBy: string;                    // User who last updated the configuration
}

/**
 * CTA Form Submission Interface
 * 
 * Data structure for user form submissions.
 * Stored in S3 for admin portal viewing and analytics.
 */
export interface CTASubmission {
  submissionId: string;                 // Unique submission identifier
  sessionId: string;                    // Associated chat session ID
  userDetails: {
    name: string;                       // User's name
    email: string;                      // User's email address
    message: string;                    // User's message (max 500 chars)
  };
  metadata: {
    submittedAt: string;                // ISO timestamp of submission
    ipAddress?: string;                 // User's IP address (optional, for analytics)
    userAgent?: string;                 // User's browser info (optional, for analytics)
    avatarId: string;                   // Avatar ID from the chat session
    avatarName: string;                 // Avatar name from the chat session
    messageCount: number;               // Number of messages in the chat session
    chatDuration: number;               // Duration of chat in milliseconds
  };
  status: "pending" | "processed" | "failed";  // Processing status
  emailSent: boolean;                   // Whether notification emails were sent
  createdAt: string;                    // ISO timestamp when submission was created
  processedAt?: string;                 // ISO timestamp when submission was processed
  errorMessage?: string;                // Error details if processing failed
}

/**
 * QR Code Data Interface
 * 
 * Structure of data encoded in QR codes displayed on kiosk.
 * This data is URL-encoded and embedded in the QR code.
 */
export interface QRCodeData {
  sessionId: string;                    // Current chat session ID
  avatarId: string;                     // Current avatar ID
  avatarName: string;                   // Current avatar name
  timestamp: number;                    // When QR code was generated
  version: string;                      // QR code format version (for future compatibility)
}

/**
 * CTA Form Data Interface
 * 
 * Structure for form data submitted by users.
 * Used for validation and processing.
 */
export interface CTAFormData {
  sessionId: string;                    // Chat session ID from QR code
  name: string;                         // User's name (required)
  email: string;                        // User's email (required, validated)
  message: string;                      // User's message (optional, max 500 chars)
  qrCodeData?: {                        // QR code validation data (optional, for enhanced validation)
    avatarId: string;
    avatarName: string;
    timestamp: number;
    version: string;
  };
}

/**
 * Email Template Variables Interface
 * 
 * Variables available for email template substitution.
 * Allows dynamic content in notification emails.
 */
export interface EmailTemplateVars {
  userName: string;                     // User's submitted name
  userEmail: string;                    // User's submitted email
  userMessage: string;                  // User's submitted message
  avatarName: string;                   // Avatar name from chat session
  submissionDate: string;               // Formatted submission date
  sessionId: string;                    // Chat session ID
  messageCount: number;                 // Number of messages in chat
  chatDuration: string;                 // Formatted chat duration
}
